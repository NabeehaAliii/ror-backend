<main>
  <section id="memee">
    <%=render "dashboard/sidebar" %>
    <div id="tormnt" class="main_side">
      <div id="top_header">
        <div class="left_blk">
          <h1>Tournament</h1>
          <div class="img">
            <img src="<%= asset_path("icon-header.svg")%>" alt="">
          </div>
        </div>
        <div class="d-flex align-items-center">
          <a href="/tournament-banner" class="site_btn prime_btn round px me-3">
            Add Banners
          </a>
          <%=render "dashboard/notification_panel" %>
        </div>
      </div>
      <div class="inner_blk tornment">
        <div class="top">
          <div class="season_detail">
            <h4 class="mb-0">Tournament Season</h4>
            <div class="form_blk">
              <%= form_for :post, :url => { :controller => 'dashboard', :action => 'tournament' }, :html => { :method => 'get', class: 'form_blk' } do |f| %>
                <%= select_tag  :tournament_banner_id, options_for_select(TournamentBanner.all.pluck(:title, :id),selected: @tournament_banner_name&.present? ? @tournament_banner_name : TournamentBanner&.first&.id), class: "input" ,onclick: "submit()" %>
              <% end %>
            </div>
            <p class="ms-3"> Participants: <span id = "joined"><%= @banner.tournament_users.count if @banner.present? %></span></p>
          </div>
          <h4 class="fw_400 mb-0">
            <a href="/tournament-winner-list" id = "banner_id">Tournament Winners</a>
          </h4>
        </div>
        <div id="table_blk">
          <table id="tournament_table">
            <thead>
            <tr id = "tr">
              <th style="width: 6rem">Rank</th>
              <th style="width: 15rem">Name</th>
              <th style="width: 22rem">Email</th>
              <th style="width: 10.6rem">Up Vote</th>
              <th style="width: 13rem">Down Vote</th>
              <th style="width: 13rem">Date Joined</th>
              <th style="width: 12rem">Participated</th>
              <th style="width: 10rem">Image</th>
              <th style="width: 8rem">Status</th>
              <th style="width: 2rem"></th>
            </tr>
            </thead>
            <tbody>
            <% i = 1 %>
            <% abc = page_entries_info @posts %>
            <% first_record_value =  abc.split("<b>")[1].split("&")[0].to_i if abc.present? %>
            <% @posts.each do |post| %>
              <tr>
                <td>
                  <% if first_record_value < 4 %>
                    <div class="win"><%=first_record_value%></div>
                  <% elsif first_record_value <= 10 %>
                    <div class="win win_5"><%=first_record_value%></div>
                  <% else %>
                    <div class="win win_10"><%=first_record_value%></div>
                  <% end %>
                </td>
                <% first_record_value+=1 %>
                <td><%=post.user.username %></td>
                <td><%=post.user.email %></td>
                <td><%=post.likes.where(is_judged: true).like.count %></td>
                <td><%=post.likes.where(is_judged: true).dislike.count%></td>
                <td><%=post.user.tournament_users.first.created_at.strftime('%B %d,%Y') %></td>
                <% banner_id = @banner.id if @banner.present? %>
                <td><%=post.user.likes.where(tournament_banner_id: banner_id).count %></td>
                <td>
                  <div class="img">
                    <img src="<%= post.post_image.attached? ? post.post_image.blob.url : asset_path("tr-1.jpg")%>" alt="">
                  </div>
                </td>
                <% if @banner.present? %>
                  <td><%=  @banner&.end_date&.strftime('%b,%d,%y') > Time.now.strftime('%b,%d,%y') ? "ongoing" : "finished" %></td>
              <%else %>
                  <td><%= "finished" %></td>
              <%end%>
                <td>
                  <div class="dropdown">
                    <button class="btn drop_btn" data-bs-toggle="dropdown">
                      <img src="<%= asset_path("icon-vdots.svg")%>" alt="">
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                      <li><button type="button">Disable Account</button></li>
                      <li>
                        <button type="button" class="pop_btn"
                                data-popup="trans_profile">Reward</button>
                      </li>
                    </ul>
                  </div>
                </td>
              </tr>
            <%end %>
            </tbody>
          </table>
        </div>
        <div class="paginate_sec">
          <p><%= page_entries_info @posts , :html => false %></p>
          <ul class="pagination">
            <li class="disabled"> <%= will_paginate(@posts, :class => "h5 text-white", :outer_window => 1, :inner_window => 0) %></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="popup" data-popup="trans_profile" id="tormnt_modal">
      <div class="table_dv">
        <div class="table_cell">
          <div class="contain">
            <div class="row justify-content-center">
              <div class="col-12">
                <div class="_inner">
                  <button type="button" class="x_btn"></button>
                  <h3>Reward</h3>
                  <div class="detail_blk">
                    <div class="left_blk">
                      <table>
                        <thead>
                        <tr>
                          <th style="width: 13rem;">Name</th>
                          <th style="width: 22rem;">Email</th>
                          <th>Date Joined</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                          <td>Mr Astronut</td>
                          <td>iammemer@memee.com</td>
                          <td>Jan 1, 2022</td>
                        </tr>
                        </tbody>
                      </table>
                      <form action="">
                        <div class="row">
                          <div class="col-12">
                            <h6 class="form_label">Gift Card #</h6>
                            <div class="form_blk">
                              <input type="text" class="input" placeholder="000000">
                            </div>
                          </div>
                          <div class="col-12">
                            <h6 class="form_label">Coin</h6>
                            <div class="form_blk">
                              <input type="text" class="input" value="2334">
                            </div>
                          </div>
                        </div>
                        <div class="btn_blk">
                          <button type="button"
                                  class="site_btn prime_btn round w-100">Send</button>
                        </div>
                      </form>
                    </div>
                    <div class="right_blk">
                      <div class="img">
                        <img src="<%= asset_path("tormnt-modal.jpg")%>" alt="">
                      </div>
                      <div class="vote_blk">
                                                <span class="vote">
                                                    <img src="<%= asset_path("icon-vote-up.svg")%>" alt="">
                                                    324
                                                </span>
                        <span class="vote vote_down">
                                                    <img src="<%= asset_path("icon-vote-down.svg")%>" alt="">
                                                    12
                                                </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>

<script>
    $('#tournament_id').click(function (){
        var radioValue = $("input[name='tournament_id']").val();
        $('#tournament_id').data('attribute',radioValue);
        $.ajax({
            type: "Get",
            url: "/tournament",
            data: { tournament_banner_id: radioValue},
            success: (response) => {
            }
        });
    });

    function open_trmnt_model(){
        document.getElementById("tormnt_modal").style.display="block"
    }
</script>